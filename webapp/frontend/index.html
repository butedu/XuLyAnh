<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Smile Detection Demo</title>
    <style>
        :root {
            --bg-gradient: radial-gradient(circle at top left, #1f2a62 0%, #111428 55%, #090b16 100%);
            --panel-bg: rgba(17, 24, 39, 0.72);
            --panel-border: rgba(148, 163, 184, 0.14);
            --panel-shadow: 0 30px 60px rgba(6, 12, 34, 0.55);
            --primary: #6366f1;
            --primary-soft: rgba(99, 102, 241, 0.12);
            --accent: #22d3ee;
            --accent-soft: rgba(34, 211, 238, 0.12);
            --danger: #f87171;
            --text-primary: #f8fafc;
            --text-muted: #9aa2be;
            --surface-strong: rgba(248, 250, 252, 0.06);
            --radius-lg: 22px;
            --radius-md: 18px;
            --radius-sm: 12px;
            font-family: "Inter", -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @keyframes progressGlow {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        *, *::before, *::after {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            min-height: 100vh;
            display: flex;
            align-items: flex-start;
            justify-content: center;
            background: var(--bg-gradient);
            color: var(--text-primary);
            padding: clamp(2.5rem, 6vw, 4rem);
        }

        .app {
            width: min(1280px, 100%);
            display: flex;
            flex-direction: column;
            gap: clamp(2rem, 4vw, 3rem);
        }

        .hero {
            position: relative;
            overflow: hidden;
            border-radius: var(--radius-lg);
            padding: clamp(2rem, 4vw, 3rem);
            background: linear-gradient(135deg, rgba(67, 56, 202, 0.9), rgba(14, 165, 233, 0.75));
            box-shadow: var(--panel-shadow);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: clamp(1.8rem, 4vw, 2.6rem);
        }

        .hero::after {
            content: "";
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at 20% 20%, rgba(255, 255, 255, 0.2), transparent 55%),
                        radial-gradient(circle at 80% 0%, rgba(14, 165, 233, 0.25), transparent 50%);
            mix-blend-mode: screen;
            pointer-events: none;
        }

        .hero-content,
        .hero-cta {
            position: relative;
            z-index: 1;
        }

        .hero-content h1 {
            margin: 0;
            font-size: clamp(2.3rem, 4vw, 3.4rem);
            line-height: 1.1;
            letter-spacing: -0.02em;
        }

        .hero-content p {
            margin-top: 1rem;
            font-size: 1.05rem;
            max-width: 540px;
            color: rgba(255, 255, 255, 0.82);
        }

        .hero-tags {
            margin-top: 1.5rem;
            display: flex;
            flex-wrap: wrap;
            gap: 0.7rem;
        }

        .tag {
            padding: 0.4rem 0.9rem;
            border-radius: 999px;
            background: rgba(15, 23, 42, 0.25);
            color: var(--text-primary);
            font-size: 0.82rem;
            font-weight: 600;
            letter-spacing: 0.04em;
            text-transform: uppercase;
        }

        .hero-cta {
            align-self: center;
            background: rgba(15, 23, 42, 0.32);
            border-radius: var(--radius-md);
            padding: clamp(1.5rem, 3vw, 2rem);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(248, 250, 252, 0.16);
            display: grid;
            gap: 1.25rem;
        }

        .hero-cta h3 {
            margin: 0;
            font-size: 1.25rem;
            font-weight: 600;
        }

        .hero-metric {
            display: flex;
            align-items: center;
            gap: 0.9rem;
            padding: 0.75rem 1rem;
            border-radius: var(--radius-sm);
            background: rgba(248, 250, 252, 0.08);
        }

        .hero-metric strong {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .hero-metric span {
            font-size: 0.92rem;
            color: rgba(241, 245, 249, 0.75);
        }

        .section-nav {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
        }

        .section-tab {
            background: var(--surface-strong);
            color: var(--text-muted);
            border: 1px solid rgba(148, 163, 184, 0.25);
            border-radius: 999px;
            padding: 0.65rem 1.4rem;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.25s ease, color 0.25s ease, box-shadow 0.25s ease, transform 0.2s ease;
        }

        .section-tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 14px 28px rgba(15, 23, 42, 0.35);
        }

        .section-tab.is-active {
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.9), rgba(34, 211, 238, 0.85));
            color: var(--text-primary);
            border-color: rgba(148, 163, 184, 0.35);
            box-shadow: 0 18px 36px rgba(34, 211, 238, 0.25);
        }

        .section {
            display: none;
        }

        .section.is-active {
            display: block;
        }

        .section[data-section="image"] .content-grid {
            margin-top: clamp(1.5rem, 3vw, 2.5rem);
        }

        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: clamp(1.8rem, 4vw, 2.5rem);
        }

        .panel {
            position: relative;
            background: var(--panel-bg);
            border: 1px solid var(--panel-border);
            border-radius: var(--radius-md);
            padding: clamp(1.6rem, 3vw, 2.1rem);
            box-shadow: var(--panel-shadow);
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .panel::before {
            content: "";
            position: absolute;
            inset: 0;
            border-radius: inherit;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.18), transparent);
            opacity: 0.65;
            pointer-events: none;
        }

        .panel > * {
            position: relative;
            z-index: 1;
        }

        .panel h2 {
            margin: 0;
            font-size: 1.45rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            letter-spacing: -0.01em;
        }

        .panel h2::before {
            content: "";
            width: 12px;
            height: 12px;
            border-radius: 999px;
            background: var(--primary);
            box-shadow: 0 0 0 6px rgba(99, 102, 241, 0.15);
        }

        .status {
            font-size: 0.95rem;
            color: var(--text-muted);
        }

        .upload-area {
            border: 1.5px dashed rgba(148, 163, 184, 0.35);
            border-radius: calc(var(--radius-md) - 6px);
            padding: clamp(2rem, 3vw, 2.4rem);
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
            background: rgba(15, 23, 42, 0.45);
        }

        .upload-area:hover,
        .upload-area.dragover {
            border-color: var(--accent);
            box-shadow: 0 20px 35px rgba(14, 165, 233, 0.18);
            transform: translateY(-3px);
        }

        .upload-area p {
            margin: 0.9rem 0 0;
            color: rgba(226, 232, 240, 0.78);
        }

        .upload-area strong {
            color: var(--accent);
        }

        .preview-grid {
            display: grid;
            gap: clamp(1rem, 3vw, 1.5rem);
        }

        .preview-wrapper {
            position: relative;
            border-radius: calc(var(--radius-md) - 6px);
            overflow: hidden;
            background: rgba(15, 23, 42, 0.75);
            min-height: 260px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid rgba(148, 163, 184, 0.12);
        }

        .preview-wrapper img,
        .preview-wrapper video {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: none;
        }

        .preview-wrapper video {
            background: #000;
        }

        .empty-preview {
            color: rgba(148, 163, 184, 0.65);
            font-size: 0.95rem;
        }

        .actions {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 1rem;
        }

        button {
            background: var(--primary);
            color: var(--text-primary);
            border: none;
            padding: 0.85rem 1.7rem;
            border-radius: 999px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.3s ease;
            box-shadow: 0 16px 35px rgba(99, 102, 241, 0.3);
        }

        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 25px 40px rgba(99, 102, 241, 0.35);
        }

        button:disabled {
            background: rgba(99, 102, 241, 0.45);
            cursor: not-allowed;
            box-shadow: none;
        }

        button.is-loading {
            position: relative;
            color: transparent;
        }

        button.is-loading::after {
            content: "ƒêang x·ª≠ l√Ω...";
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-primary);
        }

        .status-chip {
            display: inline-flex;
            align-items: center;
            gap: 0.45rem;
            padding: 0.45rem 0.9rem;
            border-radius: 999px;
            background: rgba(148, 163, 184, 0.16);
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .error {
            color: var(--danger);
            font-weight: 600;
        }

        .results-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 1.1rem;
        }

        .stat-card {
            border-radius: calc(var(--radius-md) - 10px);
            padding: 1.3rem 1.4rem;
            background: rgba(99, 102, 241, 0.12);
            border: 1px solid rgba(99, 102, 241, 0.25);
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
        }

        .stat-card span {
            text-transform: uppercase;
            letter-spacing: 0.08em;
            font-size: 0.72rem;
            color: rgba(226, 232, 240, 0.72);
        }

        .stat-card strong {
            font-size: 2.05rem;
            font-weight: 700;
        }

        .det-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 1rem;
        }

        .det-card {
            border-radius: calc(var(--radius-md) - 12px);
            padding: 1rem 1.25rem;
            background: rgba(15, 23, 42, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.2);
            display: grid;
            gap: 0.55rem;
        }

        .det-card header {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            font-weight: 600;
        }

        .det-card small {
            color: rgba(203, 213, 225, 0.78);
            font-size: 0.86rem;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.3rem 0.75rem;
            border-radius: 999px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .badge-smile {
            background: rgba(74, 222, 128, 0.2);
            color: #bbf7d0;
        }

        .badge-nosmile {
            background: rgba(248, 113, 113, 0.2);
            color: #fecaca;
        }

        .annotated-wrapper {
            border-radius: calc(var(--radius-md) - 10px);
            overflow: hidden;
            border: 1px solid rgba(148, 163, 184, 0.24);
            background: rgba(9, 12, 26, 0.92);
            min-height: 360px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .annotated-wrapper img,
        .annotated-wrapper video {
            width: 100%;
            max-height: 620px;
            object-fit: contain;
            display: none;
        }

        .annotated-wrapper video {
            background: #000;
        }

        .annotated-placeholder {
            padding: 1.6rem;
            text-align: center;
            color: rgba(148, 163, 184, 0.78);
            font-size: 0.96rem;
        }

        .empty-result {
            padding: 1.3rem;
            text-align: center;
            color: rgba(148, 163, 184, 0.85);
            border: 1px dashed rgba(148, 163, 184, 0.28);
            border-radius: calc(var(--radius-md) - 12px);
            background: rgba(15, 23, 42, 0.45);
        }

        .video-panel .upload-area {
            background: rgba(34, 211, 238, 0.08);
            border-color: rgba(34, 211, 238, 0.32);
        }

        .video-panel .upload-area:hover {
            box-shadow: 0 20px 45px rgba(34, 211, 238, 0.2);
        }

        .live-panel {
            margin-top: clamp(2rem, 4vw, 3rem);
            background: rgba(34, 211, 238, 0.08);
            border-color: rgba(34, 211, 238, 0.28);
        }

        .live-panel::before {
            background: linear-gradient(135deg, rgba(34, 211, 238, 0.18), transparent);
        }

        .live-view {
            position: relative;
            border-radius: calc(var(--radius-md) - 6px);
            overflow: hidden;
            border: 1px solid rgba(34, 211, 238, 0.28);
            background: rgba(8, 11, 24, 0.8);
            min-height: 320px;
        }

        .live-view video,
        .live-view canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .live-view video {
            object-fit: cover;
            filter: saturate(1.1);
        }

        .live-view canvas {
            position: absolute;
            inset: 0;
            pointer-events: none;
        }

        .live-controls {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 1rem;
        }

        .live-controls button {
            background: var(--accent);
            box-shadow: 0 16px 35px rgba(34, 211, 238, 0.28);
        }

        .live-controls button:disabled {
            background: rgba(34, 211, 238, 0.38);
            box-shadow: none;
        }

        .live-meta {
            margin-top: 1rem;
        }

        .live-summary {
            margin-top: 1rem;
            padding: 1rem 1.25rem;
            border-radius: calc(var(--radius-md) - 12px);
            background: rgba(15, 23, 42, 0.55);
            border: 1px solid rgba(34, 211, 238, 0.22);
            color: rgba(226, 232, 240, 0.88);
            font-size: 0.95rem;
            line-height: 1.6;
        }

        .live-summary strong {
            color: var(--accent);
            font-weight: 700;
        }

        .live-status-ready {
            color: #4ade80;
        }

        .live-status-idle {
            color: rgba(148, 163, 184, 0.8);
        }

        /* Tracking card hover effects */
        #peopleList > div {
            cursor: default;
        }

        #peopleList > div:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5) !important;
        }

        @media (max-width: 768px) {
            body { padding: 2rem 1.25rem; }
            .hero { grid-template-columns: 1fr; }
            .hero-cta { order: -1; }
        }

        footer {
            text-align: center;
            font-size: 0.85rem;
            color: rgba(148, 163, 184, 0.7);
        }

        footer a {
            color: var(--accent);
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="app">
        <header class="hero">
            <div class="hero-content">
                <h1>Smile Insight Studio</h1>
                <p>
                    Gi·∫£i ph√°p th·ªã gi√°c m√°y t√≠nh gi√∫p ph√°t hi·ªán n·ª• c∆∞·ªùi tr√™n ·∫£nh v√† video b·∫±ng YOLOv8-face
                    k·∫øt h·ª£p m·∫°ng CNN chuy√™n d·ª•ng. Theo d√µi th·ªëng k√™ tr·ª±c quan ngay tr√™n tr√¨nh duy·ªát c·ªßa b·∫°n.
                </p>
                <div class="hero-tags">
                    <span class="tag">Realtime Vision</span>
                    <span class="tag">YOLOv8-face</span>
                    <span class="tag">SmileNet</span>
                    <span class="tag">FastAPI</span>
                </div>
            </div>
            <div class="hero-cta">
                <h3>S·∫µn s√†ng tr·∫£i nghi·ªám?</h3>
                <div class="hero-metric">
                    <strong>·∫¢nh</strong>
                    <span>T·∫£i ·∫£nh nh√≥m v√† nh·∫≠n k·∫øt qu·∫£ ch√∫ th√≠ch chi ti·∫øt trong v√†i gi√¢y.</span>
                </div>
                <div class="hero-metric">
                    <strong>Video</strong>
                    <span>T·∫°o video g·∫Øn nh√£n c√πng th·ªëng k√™ n·ª• c∆∞·ªùi theo th·ªùi gian th·ª±c.</span>
                </div>
            </div>
        </header>

        <nav class="section-nav">
            <button type="button" class="section-tab is-active" data-section-target="image">·∫¢nh</button>
            <button type="button" class="section-tab" data-section-target="video">Video</button>
            <button type="button" class="section-tab" data-section-target="camera">Camera</button>
        </nav>

        <div class="section is-active" data-section="image">
            <div class="content-grid">
                <section class="panel capture-panel">
                    <h2>1. Ph√¢n t√≠ch ·∫£nh</h2>
                    <p class="status">
                        K√©o th·∫£ ho·∫∑c ch·ªçn ·∫£nh JPEG/PNG. Smile Insight Studio s·∫Ω ph√°t hi·ªán khu√¥n m·∫∑t v√† ƒë√°nh gi√° n·ª• c∆∞·ªùi ch·ªâ sau v√†i gi√¢y.
                    </p>
                    <div id="upload" class="upload-area">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" color="var(--accent)">
                            <path d="M4 17v-1a3 3 0 0 1 3-3h1" />
                            <path d="M12 13v-9" />
                            <path d="m9 7 3-3 3 3" />
                            <path d="M9 17h6" />
                            <path d="M20 17v-1a3 3 0 0 0-3-3h-1" />
                            <path d="M3 17a4 4 0 0 0 4 4h10a4 4 0 0 0 4-4" />
                        </svg>
                        <p><strong>K√©o th·∫£</strong> ho·∫∑c b·∫•m ƒë·ªÉ ch·ªçn ·∫£nh</p>
                    </div>
                    <input type="file" id="fileInput" accept="image/*" hidden />

                    <div class="preview-grid">
                        <div class="preview-wrapper">
                            <img id="preview" alt="·∫¢nh t·∫£i l√™n" />
                            <span id="previewPlaceholder" class="empty-preview">·∫¢nh s·∫Ω hi·ªÉn th·ªã t·∫°i ƒë√¢y sau khi t·∫£i l√™n.</span>
                        </div>
                        
                        <!-- Threshold slider cho ·∫£nh -->
                        <div style="margin: 1rem 0; padding: 1rem; background: rgba(99, 102, 241, 0.08); border-radius: 12px; border: 1px solid rgba(99, 102, 241, 0.2);">
                            <label style="display: block; margin-bottom: 0.75rem; font-weight: 600; color: var(--accent);">
                                Ng∆∞·ª°ng ph√°t hi·ªán c∆∞·ªùi (Threshold): <span id="imageThresholdValue">0.40</span>
                            </label>
                            <input type="range" id="imageThreshold" min="0" max="1" step="0.05" value="0.40" style="width: 100%; cursor: pointer;" />
                            <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-muted); margin-top: 0.25rem;">
                                <span>0.00 (D·ªÖ)</span>
                                <span>0.50</span>
                                <span>1.00 (Kh√≥)</span>
                            </div>
                        </div>
                        
                        <div class="actions">
                            <button id="analyzeBtn" disabled>Ph√¢n t√≠ch ·∫£nh</button>
                            <div id="status" class="status"></div>
                        </div>
                        <div id="error" class="error"></div>
                    </div>
                </section>

                <section class="panel results-panel">
                    <h2>2. K·∫øt qu·∫£ ·∫£nh</h2>
                    <div class="results-meta">
                        <div class="stat-card">
                            <span>T·ªïng khu√¥n m·∫∑t</span>
                            <strong id="statTotal">‚Äî</strong>
                        </div>
                        <div class="stat-card">
                            <span>S·ªë ng∆∞·ªùi c∆∞·ªùi</span>
                            <strong id="statSmile">‚Äî</strong>
                        </div>
                        <div class="stat-card">
                            <span>X√°c su·∫•t trung b√¨nh</span>
                            <strong id="statProb">‚Äî</strong>
                        </div>
                    </div>

                    <div id="result" class="empty-result">Ch∆∞a c√≥ d·ªØ li·ªáu. H√£y ch·ªçn ·∫£nh ƒë·ªÉ b·∫Øt ƒë·∫ßu ph√¢n t√≠ch.</div>

                    <div class="det-grid" id="detectionList" hidden></div>

                    <div class="annotated-wrapper">
                        <img id="annotated" alt="K·∫øt qu·∫£ ch√∫ th√≠ch" />
                        <div id="annotatedPlaceholder" class="annotated-placeholder">
                            ·∫¢nh ch√∫ th√≠ch k√≠ch th∆∞·ªõc l·ªõn s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y sau khi ph√¢n t√≠ch.
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <div class="section" data-section="video">
            <section class="panel video-panel">
                <h2>3. Ph√¢n t√≠ch video</h2>
                <p class="status">
                    T·∫£i video MP4/MOV ƒë·ªÉ t·∫°o b·∫£n xu·∫•t ch√∫ th√≠ch v·ªõi th·ªëng k√™ n·ª• c∆∞·ªùi theo th·ªùi gian. H·ªá th·ªëng x·ª≠ l√Ω t·ª´ng khung h√¨nh v√† tr·∫£ v·ªÅ video m·ªõi.
                </p>
                <div id="videoUpload" class="upload-area">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" color="var(--accent)">
                        <path d="M3 7h6l2 3h10" />
                        <rect x="3" y="16" width="6" height="5" rx="1.5" />
                        <path d="M16 13h5v7h-5z" />
                        <path d="M16 16l5-3" />
                    </svg>
                    <p><strong>K√©o th·∫£</strong> ho·∫∑c b·∫•m ƒë·ªÉ ch·ªçn video</p>
                </div>
                <input type="file" id="videoInput" accept="video/*" hidden />

                <div class="preview-grid">
                    <div class="preview-wrapper">
                        <video id="videoPreview" controls></video>
                        <span id="videoPlaceholder" class="empty-preview">Video s·∫Ω hi·ªÉn th·ªã t·∫°i ƒë√¢y sau khi t·∫£i l√™n.</span>
                    </div>
                    <div style="margin: 1rem 0; padding: 1rem; background: rgba(99, 102, 241, 0.08); border-radius: 12px; border: 1px solid rgba(99, 102, 241, 0.2);">
                        <label style="display: flex; align-items: center; gap: 0.75rem; cursor: pointer; font-size: 1rem;">
                            <input type="checkbox" id="enableTracking" style="width: 20px; height: 20px; cursor: pointer;" />
                            <div>
                                <strong style="color: var(--accent);">B·∫≠t Face Tracking</strong>
                                <p style="margin: 0.3rem 0 0 0; font-size: 0.85rem; color: var(--text-muted);">G√°n ID c·ªë ƒë·ªãnh cho t·ª´ng ng∆∞·ªùi v√† t√≠nh th·ªëng k√™ ri√™ng theo ID (ch·∫≠m h∆°n nh∆∞ng chi ti·∫øt h∆°n)</p>
                            </div>
                        </label>
                    </div>
                    
                    <!-- Threshold slider cho video -->
                    <div style="margin: 1rem 0; padding: 1rem; background: rgba(34, 211, 238, 0.08); border-radius: 12px; border: 1px solid rgba(34, 211, 238, 0.2);">
                        <label style="display: block; margin-bottom: 0.75rem; font-weight: 600; color: var(--accent);">
                            Ng∆∞·ª°ng ph√°t hi·ªán c∆∞·ªùi (Threshold): <span id="videoThresholdValue">0.40</span>
                        </label>
                        <input type="range" id="videoThreshold" min="0" max="1" step="0.05" value="0.40" style="width: 100%; cursor: pointer;" />
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-muted); margin-top: 0.25rem;">
                            <span>0.00 (D·ªÖ)</span>
                            <span>0.50</span>
                            <span>1.00 (Kh√≥)</span>
                        </div>
                    </div>
                    
                    <!-- Frame Skip slider cho video -->
                    <div style="margin: 1rem 0; padding: 1rem; background: rgba(139, 92, 246, 0.08); border-radius: 12px; border: 1px solid rgba(139, 92, 246, 0.2);">
                        <label style="display: block; margin-bottom: 0.75rem; font-weight: 600; color: #8b5cf6;">
                            B·ªè qua khung h√¨nh (Frame Skip): <span id="videoFrameSkipValue">0</span> khung h√¨nh
                        </label>
                        <input type="range" id="videoFrameSkip" min="0" max="10" step="1" value="0" style="width: 100%; cursor: pointer;" />
                        <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-muted); margin-top: 0.25rem;">
                            <span>0 (X·ª≠ l√Ω t·∫•t c·∫£)</span>
                            <span>5</span>
                            <span>10 (Nhanh nh·∫•t)</span>
                        </div>
                        <p style="margin: 0.5rem 0 0 0; font-size: 0.8rem; color: var(--text-muted); font-style: italic;">üí° TƒÉng gi√° tr·ªã ƒë·ªÉ x·ª≠ l√Ω nhanh h∆°n, gi·∫£m ƒë·ªÉ chi ti·∫øt h∆°n</p>
                    </div>
                    
                    <div class="actions">
                        <button id="analyzeVideoBtn" disabled>Ph√¢n t√≠ch video</button>
                        <div id="videoStatus" class="status"></div>
                    </div>
                    <div id="videoError" class="error"></div>
                    
                    <!-- Loading progress indicator -->
                    <div id="videoLoadingProgress" hidden style="margin-top: 1rem; padding: 1.5rem; background: linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(139, 92, 246, 0.1) 100%); border-radius: 16px; border: 2px solid rgba(99, 102, 241, 0.3); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <div class="spinner" style="width: 32px; height: 32px; border: 3px solid rgba(99, 102, 241, 0.2); border-top-color: var(--accent); border-radius: 50%; animation: spin 1s linear infinite;"></div>
                            <div style="flex: 1;">
                                <div style="font-size: 1.1rem; font-weight: 600; color: var(--accent); margin-bottom: 0.3rem;">ƒêang x·ª≠ l√Ω video...</div>
                                <div style="font-size: 0.9rem; color: var(--text-muted);">Vui l√≤ng ch·ªù, qu√° tr√¨nh n√†y c√≥ th·ªÉ m·∫•t v√†i ph√∫t t√πy thu·ªôc v√†o ƒë·ªô d√†i video</div>
                            </div>
                        </div>
                        <div style="width: 100%; height: 6px; background: rgba(148, 163, 184, 0.15); border-radius: 999px; overflow: hidden;">
                            <div style="width: 100%; height: 100%; background: linear-gradient(90deg, #6366f1, #8b5cf6, #6366f1); background-size: 200% 100%; animation: progressGlow 2s linear infinite;"></div>
                        </div>
                    </div>
                </div>

                <div class="results-meta" id="videoMeta" hidden>
                    <div class="stat-card" style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(139, 92, 246, 0.1) 100%); border: 2px solid rgba(99, 102, 241, 0.3);">
                        <span style="display: flex; align-items: center; gap: 0.4rem;"><span style="font-size: 1.2rem;">üé¨</span> T·ªïng khung h√¨nh</span>
                        <strong id="videoTotalFrames" style="font-size: 1.8rem; color: #6366f1;">‚Äî</strong>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, rgba(34, 211, 238, 0.15) 0%, rgba(6, 182, 212, 0.1) 100%); border: 2px solid rgba(34, 211, 238, 0.3);">
                        <span style="display: flex; align-items: center; gap: 0.4rem;"><span style="font-size: 1.2rem;">üîç</span> Khung h√¨nh ph√¢n t√≠ch</span>
                        <strong id="videoProcessedFrames" style="font-size: 1.8rem; color: #22d3ee;">‚Äî</strong>
                    </div>
                    <div class="stat-card" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.15) 0%, rgba(22, 163, 74, 0.1) 100%); border: 2px solid rgba(34, 197, 94, 0.3);">
                        <span style="display: flex; align-items: center; gap: 0.4rem;"><span style="font-size: 1.2rem;">üòä</span> L·∫ßn m·ªâm c∆∞·ªùi</span>
                        <strong id="videoSmileCount" style="font-size: 1.8rem; color: #22c55e;">‚Äî</strong>
                    </div>
                </div>

                <div id="videoSummary" class="empty-result" style="padding: 2rem; text-align: center; background: rgba(15, 23, 42, 0.5); border-radius: 16px; border: 1px solid rgba(148, 163, 184, 0.15);">
                    <div style="font-size: 2.5rem; margin-bottom: 1rem; opacity: 0.6;">üìä</div>
                    <div style="font-size: 1rem; color: var(--text-muted); margin-bottom: 0.5rem;">Ch∆∞a c√≥ d·ªØ li·ªáu video</div>
                    <div style="font-size: 0.9rem; color: rgba(148, 163, 184, 0.6);">H√£y ch·ªçn video ƒë·ªÉ b·∫Øt ƒë·∫ßu ph√¢n t√≠ch</div>
                </div>

                <div id="trackingStats" hidden style="margin-top: 2rem;">
                    <div style="background: linear-gradient(135deg, rgba(99, 102, 241, 0.15) 0%, rgba(139, 92, 246, 0.1) 100%); padding: 1.25rem; border-radius: 16px; border: 2px solid rgba(99, 102, 241, 0.3); margin-bottom: 1.5rem; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);">
                        <h3 style="margin: 0; font-size: 1.3rem; color: var(--accent); display: flex; align-items: center; gap: 0.75rem;">
                            <span style="font-size: 1.8rem;">üìä</span>
                            <span>Th·ªëng k√™ theo t·ª´ng ng∆∞·ªùi (Face Tracking)</span>
                        </h3>
                        <p style="margin: 0.5rem 0 0 0; color: var(--text-muted); font-size: 0.9rem;">Theo d√µi t·ª´ng ng∆∞·ªùi xu·∫•t hi·ªán trong video v·ªõi ID ri√™ng bi·ªát</p>
                    </div>
                    <div id="peopleList" style="display: grid; gap: 1.25rem;"></div>
                </div>

                <div class="annotated-wrapper">
                    <video id="videoResult" controls></video>
                    <div id="videoResultPlaceholder" class="annotated-placeholder" style="display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 1rem; min-height: 300px;">
                        <div style="font-size: 3rem; opacity: 0.5;">üé•</div>
                        <div style="font-size: 1rem; color: var(--text-muted);">Video ƒë√£ ch√∫ th√≠ch s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y</div>
                        <div style="font-size: 0.85rem; color: rgba(148, 163, 184, 0.5);">T·∫£i l√™n video v√† nh·∫•n "Ph√¢n t√≠ch video" ƒë·ªÉ b·∫Øt ƒë·∫ßu</div>
                    </div>
                </div>
            </section>
        </div>

        <div class="section" data-section="camera">
            <section class="panel live-panel">
                <h2>4. Nh·∫≠n di·ªán tr·ª±c ti·∫øp t·ª´ camera</h2>
                <p class="status">
                    K·∫øt n·ªëi camera m√°y t√≠nh v√† nh·∫≠n k·∫øt qu·∫£ n·ª• c∆∞·ªùi g·∫ßn nh∆∞ theo th·ªùi gian th·ª±c. Tr√¨nh duy·ªát s·∫Ω ch·ªâ g·ª≠i t·ª´ng khung h√¨nh c·∫ßn thi·∫øt t·ªõi m√°y ch·ªß.
                </p>

                <div class="live-view">
                    <video id="liveVideo" autoplay muted playsinline></video>
                    <canvas id="liveOverlay"></canvas>
                </div>
                
                <!-- Threshold slider cho camera -->
                <div style="margin: 1rem 0; padding: 1rem; background: rgba(34, 197, 94, 0.08); border-radius: 12px; border: 1px solid rgba(34, 197, 94, 0.2);">
                    <label style="display: block; margin-bottom: 0.75rem; font-weight: 600; color: #22c55e;">
                        Ng∆∞·ª°ng ph√°t hi·ªán c∆∞·ªùi (Threshold): <span id="cameraThresholdValue">0.40</span>
                    </label>
                    <input type="range" id="cameraThreshold" min="0" max="1" step="0.05" value="0.40" style="width: 100%; cursor: pointer;" />
                    <div style="display: flex; justify-content: space-between; font-size: 0.8rem; color: var(--text-muted); margin-top: 0.25rem;">
                        <span>0.00 (D·ªÖ)</span>
                        <span>0.50</span>
                        <span>1.00 (Kh√≥)</span>
                    </div>
                </div>

                <div class="live-controls">
                    <button id="startLiveBtn">B·∫Øt ƒë·∫ßu camera</button>
                    <button id="stopLiveBtn" disabled>D·ª´ng</button>
                    <span id="liveStatus" class="status-chip live-status-idle">Ch∆∞a k√≠ch ho·∫°t</span>
                </div>
                <div id="liveError" class="error"></div>

                <div class="results-meta live-meta">
                    <div class="stat-card">
                        <span>Khu√¥n m·∫∑t</span>
                        <strong id="liveTotalFaces">‚Äî</strong>
                    </div>
                    <div class="stat-card">
                        <span>ƒêang c∆∞·ªùi</span>
                        <strong id="liveSmilingFaces">‚Äî</strong>
                    </div>
                    <div class="stat-card">
                        <span>T·∫ßn su·∫•t</span>
                        <strong id="liveDetectionRate">‚Äî</strong>
                    </div>
                </div>

                <div id="liveSummary" class="live-summary">
                    Ngay khi camera ho·∫°t ƒë·ªông, c√°c khung h√¨nh s·∫Ω ƒë∆∞·ª£c ph√¢n t√≠ch ƒë·ªãnh k·ª≥ ƒë·ªÉ c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng n·ª• c∆∞·ªùi.
                </div>
            </section>
        </div>

        <footer>
            ƒê∆∞·ª£c v·∫≠n h√†nh b·ªüi YOLOv8-face, SmileNet v√† FastAPI. <a href="https://github.com/butedu" target="_blank" rel="noreferrer">butedu</a>.
        </footer>
    </div>

    <script>
        const uploadArea = document.getElementById('upload');
        const fileInput = document.getElementById('fileInput');
        const previewImg = document.getElementById('preview');
        const previewPlaceholder = document.getElementById('previewPlaceholder');
        const analyzeBtn = document.getElementById('analyzeBtn');
        const statusEl = document.getElementById('status');
        const resultEl = document.getElementById('result');
        const detectionList = document.getElementById('detectionList');
        const annotatedImg = document.getElementById('annotated');
        const annotatedPlaceholder = document.getElementById('annotatedPlaceholder');
        const errorEl = document.getElementById('error');
        const statTotal = document.getElementById('statTotal');
        const statSmile = document.getElementById('statSmile');
        const statProb = document.getElementById('statProb');

        const videoUploadArea = document.getElementById('videoUpload');
        const videoInput = document.getElementById('videoInput');
        const videoPreview = document.getElementById('videoPreview');
        const videoPlaceholder = document.getElementById('videoPlaceholder');
        const analyzeVideoBtn = document.getElementById('analyzeVideoBtn');
        const videoStatusEl = document.getElementById('videoStatus');
        const videoErrorEl = document.getElementById('videoError');
        const videoMeta = document.getElementById('videoMeta');
        const videoTotalFrames = document.getElementById('videoTotalFrames');
        const videoProcessedFrames = document.getElementById('videoProcessedFrames');
        const videoSmileCount = document.getElementById('videoSmileCount');
        const videoSummaryEl = document.getElementById('videoSummary');
        const videoResult = document.getElementById('videoResult');
        const videoResultPlaceholder = document.getElementById('videoResultPlaceholder');
        const enableTracking = document.getElementById('enableTracking');
        const trackingStats = document.getElementById('trackingStats');
        const peopleList = document.getElementById('peopleList');
        const liveVideo = document.getElementById('liveVideo');
        const liveOverlay = document.getElementById('liveOverlay');
        const startLiveBtn = document.getElementById('startLiveBtn');
        const stopLiveBtn = document.getElementById('stopLiveBtn');
        const liveStatusChip = document.getElementById('liveStatus');
        const liveErrorEl = document.getElementById('liveError');
        const liveTotalFaces = document.getElementById('liveTotalFaces');
        const liveSmilingFaces = document.getElementById('liveSmilingFaces');
        const liveDetectionRate = document.getElementById('liveDetectionRate');
        const liveSummary = document.getElementById('liveSummary');
        const sectionTabs = Array.from(document.querySelectorAll('.section-tab'));
        const sectionBlocks = Array.from(document.querySelectorAll('[data-section]'));

        let selectedFile = null;
        let selectedVideo = null;
        let previewVideoUrl = null;
        let resultVideoUrl = null;
        let liveStream = null;
        let liveIntervalId = null;
        let liveProcessing = false;
        let lastLiveDetection = null;
        let liveDetectionsCount = 0;
        let liveStartTimestamp = null;
        let currentSection = 'image';
        const LIVE_CAPTURE_INTERVAL = 1200;
        const liveCaptureCanvas = document.createElement('canvas');
        const liveCaptureCtx = liveCaptureCanvas.getContext('2d');

        const setLoading = loading => {
            analyzeBtn.disabled = loading || !selectedFile;
            analyzeBtn.classList.toggle('is-loading', loading);
        };

        const resetResults = () => {
            statTotal.textContent = '‚Äî';
            statSmile.textContent = '‚Äî';
            statProb.textContent = '‚Äî';
            resultEl.className = 'empty-result';
            resultEl.textContent = 'Ch∆∞a c√≥ d·ªØ li·ªáu. H√£y ch·ªçn m·ªôt b·ª©c ·∫£nh ƒë·ªÉ b·∫Øt ƒë·∫ßu.';
            detectionList.innerHTML = '';
            detectionList.hidden = true;
            annotatedImg.style.display = 'none';
            annotatedImg.src = '';
            annotatedPlaceholder.style.display = 'block';
        };

        const updatePreview = file => {
            const reader = new FileReader();
            reader.onload = e => {
                previewImg.src = e.target.result;
                previewImg.style.display = 'block';
                previewPlaceholder.style.display = 'none';
            };
            reader.readAsDataURL(file);
        };

        const handleFiles = files => {
            if (!files || !files.length) return;
            const file = files[0];
            if (!file.type.startsWith('image/')) {
                errorEl.textContent = 'Vui l√≤ng ch·ªçn m·ªôt t·ªáp ·∫£nh h·ª£p l·ªá.';
                return;
            }
            selectedFile = file;
            updatePreview(file);
            analyzeBtn.disabled = false;
            statusEl.textContent = `File: ${file.name} ‚Ä¢ ${(file.size / 1024).toFixed(1)} KB`;
            errorEl.textContent = '';
            resetResults();
            activateSection('image');
        };

        const renderDetections = detections => {
            if (!detections.length) {
                detectionList.innerHTML = '';
                detectionList.hidden = true;
                return;
            }
            detectionList.hidden = false;
            detectionList.innerHTML = detections
                .map((item, index) => {
                    const smile = item.is_smiling;
                    const prob = (item.smile_probability * 100).toFixed(1);
                    const conf = (item.confidence * 100).toFixed(1);
                    return `
                        <article class="det-card">
                            <header>
                                <span>Khu√¥n m·∫∑t #${index + 1}</span>
                                <span class="badge ${smile ? 'badge-smile' : 'badge-nosmile'}">
                                    ${smile ? 'ƒêang c∆∞·ªùi' : 'Kh√¥ng c∆∞·ªùi'}
                                </span>
                            </header>
                            <small>X√°c su·∫•t c∆∞·ªùi: ${prob}% ‚Ä¢ ƒê·ªô t·ª± tin ph√°t hi·ªán: ${conf}%</small>
                            <small>V·ªã tr√≠: [x=${item.box[0]}, y=${item.box[1]}, w=${item.box[2]}, h=${item.box[3]}]</small>
                        </article>
                    `;
                })
                .join('');
        };

        const setVideoLoading = loading => {
            analyzeVideoBtn.disabled = loading || !selectedVideo;
            analyzeVideoBtn.classList.toggle('is-loading', loading);
            const videoLoadingProgress = document.getElementById('videoLoadingProgress');
            if (videoLoadingProgress) {
                videoLoadingProgress.hidden = !loading;
            }
        };

        const resetVideoResults = () => {
            videoMeta.hidden = true;
            videoTotalFrames.textContent = '‚Äî';
            videoProcessedFrames.textContent = '‚Äî';
            videoSmileCount.textContent = '‚Äî';
            videoSummaryEl.className = 'empty-result';
            videoSummaryEl.innerHTML = '<div style="font-size: 2.5rem; margin-bottom: 1rem; opacity: 0.6;">üìä</div><div style="font-size: 1rem; color: var(--text-muted); margin-bottom: 0.5rem;">Ch∆∞a c√≥ d·ªØ li·ªáu video</div><div style="font-size: 0.9rem; color: rgba(148, 163, 184, 0.6);">H√£y ch·ªçn video ƒë·ªÉ b·∫Øt ƒë·∫ßu ph√¢n t√≠ch</div>';
            
            // Hide tracking stats
            const trackingStats = document.getElementById('trackingStats');
            if (trackingStats) trackingStats.hidden = true;
            
            // Remove download button
            const existingBtn = document.getElementById('downloadVideoBtn');
            if (existingBtn) existingBtn.remove();
            
            if (resultVideoUrl) {
                URL.revokeObjectURL(resultVideoUrl);
                resultVideoUrl = null;
            }
            if (videoResult) {
                videoResult.pause();
                videoResult.removeAttribute('src');
                videoResult.load();
                videoResult.style.display = 'none';
            }
            videoResultPlaceholder.style.display = 'block';
        };

        const updateVideoPreview = file => {
            if (previewVideoUrl) {
                URL.revokeObjectURL(previewVideoUrl);
            }
            previewVideoUrl = URL.createObjectURL(file);
            videoPreview.src = previewVideoUrl;
            videoPreview.style.display = 'block';
            videoPlaceholder.style.display = 'none';
        };

        const handleVideoFiles = files => {
            if (!files || !files.length) return;
            const file = files[0];
            if (!file.type.startsWith('video/')) {
                videoErrorEl.textContent = 'Vui l√≤ng ch·ªçn m·ªôt t·ªáp video h·ª£p l·ªá.';
                selectedVideo = null;
                analyzeVideoBtn.disabled = true;
                videoStatusEl.textContent = '';
                if (previewVideoUrl) {
                    URL.revokeObjectURL(previewVideoUrl);
                    previewVideoUrl = null;
                }
                videoPreview.removeAttribute('src');
                videoPreview.style.display = 'none';
                videoPlaceholder.style.display = 'block';
                return;
            }
            selectedVideo = file;
            updateVideoPreview(file);
            analyzeVideoBtn.disabled = false;
            videoStatusEl.textContent = `File: ${file.name} ‚Ä¢ ${(file.size / 1024 / 1024).toFixed(2)} MB`;
            videoErrorEl.textContent = '';
            resetVideoResults();
            activateSection('video');
        };

        const renderVideoMeta = summary => {
            const totalFrames = summary.total_frames ?? 0;
            const processedFrames = summary.processed_frames ?? 0;
            const smileCount = summary.smiles_detected ?? 0;
            videoMeta.hidden = false;
            videoTotalFrames.textContent = totalFrames;
            videoProcessedFrames.textContent = processedFrames;
            videoSmileCount.textContent = smileCount;
        };

        const setLiveStatus = (message, isActive) => {
            liveStatusChip.textContent = message;
            liveStatusChip.classList.toggle('live-status-ready', Boolean(isActive));
            liveStatusChip.classList.toggle('live-status-idle', !isActive);
        };

        const clearLiveOverlay = () => {
            const ctx = liveOverlay.getContext('2d');
            if (!ctx) return;
            ctx.clearRect(0, 0, liveOverlay.width, liveOverlay.height);
        };

        const syncLiveOverlaySize = () => {
            if (!liveVideo.videoWidth || !liveVideo.videoHeight) return;
            if (liveOverlay.width !== liveVideo.videoWidth || liveOverlay.height !== liveVideo.videoHeight) {
                liveOverlay.width = liveVideo.videoWidth;
                liveOverlay.height = liveVideo.videoHeight;
                clearLiveOverlay();
            }
        };

        const drawLiveOverlay = detections => {
            const ctx = liveOverlay.getContext('2d');
            if (!ctx) return;
            ctx.clearRect(0, 0, liveOverlay.width, liveOverlay.height);
            detections.forEach(item => {
                const box = item.box || [];
                if (box.length < 4) {
                    return;
                }
                const [x, y, w, h] = box;
                const smiling = Boolean(item.is_smiling);
                const probability = item.smile_probability ?? 0;
                ctx.lineWidth = 3;
                ctx.strokeStyle = smiling ? 'rgba(34, 211, 238, 0.9)' : 'rgba(248, 113, 113, 0.9)';
                ctx.strokeRect(x, y, w, h);
                ctx.fillStyle = 'rgba(0, 0, 0, 0.55)';
                ctx.fillRect(x, Math.max(y - 26, 0), Math.min(w, liveOverlay.width - x), 24);
                ctx.font = '16px "Inter", sans-serif';
                ctx.fillStyle = smiling ? 'rgba(34, 211, 238, 0.95)' : 'rgba(248, 113, 113, 0.95)';
                ctx.fillText(`${Math.round(probability * 100)}%`, x + 6, Math.max(y - 8, 16));
            });
        };

        const resetLiveStats = () => {
            liveTotalFaces.textContent = '‚Äî';
            liveSmilingFaces.textContent = '‚Äî';
            liveDetectionRate.textContent = '‚Äî';
            liveSummary.innerHTML = 'Ngay khi camera ho·∫°t ƒë·ªông, c√°c khung h√¨nh s·∫Ω ƒë∆∞·ª£c ph√¢n t√≠ch ƒë·ªãnh k·ª≥ ƒë·ªÉ c·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng n·ª• c∆∞·ªùi.';
            lastLiveDetection = null;
            liveDetectionsCount = 0;
            liveStartTimestamp = null;
            clearLiveOverlay();
        };

        const captureLiveFrame = async () => {
            if (!liveVideo.videoWidth || !liveVideo.videoHeight) return null;
            liveCaptureCanvas.width = liveVideo.videoWidth;
            liveCaptureCanvas.height = liveVideo.videoHeight;
            liveCaptureCtx.drawImage(liveVideo, 0, 0, liveCaptureCanvas.width, liveCaptureCanvas.height);
            const blob = await new Promise(resolve => liveCaptureCanvas.toBlob(resolve, 'image/jpeg', 0.85));
            return blob;
        };

        const handleLiveResponse = summary => {
            const totalFaces = summary.total_faces ?? 0;
            const smilingFaces = summary.smiling_faces ?? 0;
            const detections = summary.detections || [];

            liveTotalFaces.textContent = totalFaces;
            liveSmilingFaces.textContent = smilingFaces;
            drawLiveOverlay(detections);

            const now = Date.now();
            if (!liveStartTimestamp) {
                liveStartTimestamp = now;
                liveDetectionsCount = 0;
            }
            liveDetectionsCount += 1;
            lastLiveDetection = now;
            const elapsed = (now - liveStartTimestamp) / 1000;
            const rate = elapsed > 0 ? liveDetectionsCount / elapsed : 0;
            liveDetectionRate.textContent = `${rate.toFixed(2)} Hz`;

            if (totalFaces) {
                liveSummary.innerHTML = `ƒêang th·∫•y <strong>${totalFaces}</strong> khu√¥n m·∫∑t, trong ƒë√≥ <strong>${smilingFaces}</strong> ng∆∞·ªùi m·ªâm c∆∞·ªùi.`;
            } else {
                liveSummary.innerHTML = 'Kh√¥ng ph√°t hi·ªán khu√¥n m·∫∑t n√†o trong khung h√¨nh hi·ªán t·∫°i.';
            }
        };

        const analyzeLiveFrame = async () => {
            if (liveProcessing) return;
            liveProcessing = true;
            try {
                const frameBlob = await captureLiveFrame();
                if (!frameBlob) {
                    liveProcessing = false;
                    return;
                }
                const formData = new FormData();
                formData.append('file', frameBlob, 'frame.jpg');
                formData.append('threshold', cameraThreshold.value);
                const response = await fetch('/api/detect', { method: 'POST', body: formData });
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ detail: 'Kh√¥ng r√µ l·ªói' }));
                    throw new Error(errorData.detail || 'Kh√¥ng th·ªÉ ph√¢n t√≠ch khung h√¨nh camera');
                }
                const data = await response.json();
                handleLiveResponse(data.summary || {});
                setLiveStatus('ƒêang nh·∫≠n di·ªán...', true);
            } catch (err) {
                console.error(err);
                liveErrorEl.textContent = err.message || 'ƒê√£ x·∫£y ra l·ªói khi x·ª≠ l√Ω camera.';
                stopLiveCapture();
                setLiveStatus('T·∫°m d·ª´ng do l·ªói', false);
            } finally {
                liveProcessing = false;
            }
        };

        const stopLiveCapture = () => {
            if (liveIntervalId) {
                clearInterval(liveIntervalId);
                liveIntervalId = null;
            }
            if (liveStream) {
                liveStream.getTracks().forEach(track => track.stop());
                liveStream = null;
            }
            if (liveVideo) {
                liveVideo.pause();
                liveVideo.srcObject = null;
            }
            liveProcessing = false;
            resetLiveStats();
            setLiveStatus('ƒê√£ d·ª´ng', false);
            if (startLiveBtn) {
                startLiveBtn.disabled = false;
            }
            if (stopLiveBtn) {
                stopLiveBtn.disabled = true;
            }
        };

        const startLiveCapture = async () => {
            if (liveStream || liveProcessing) {
                return;
            }
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                liveErrorEl.textContent = 'Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ truy c·∫≠p camera.';
                return;
            }
            if (startLiveBtn) {
                startLiveBtn.disabled = true;
            }
            if (!liveVideo || !liveOverlay) {
                liveErrorEl.textContent = 'Kh√¥ng t√¨m th·∫•y th√†nh ph·∫ßn hi·ªÉn th·ªã camera tr√™n trang.';
                if (startLiveBtn) {
                    startLiveBtn.disabled = false;
                }
                return;
            }
            liveErrorEl.textContent = '';
            resetLiveStats();
            try {
                activateSection('camera');
                const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } });
                liveStream = stream;
                liveVideo.srcObject = stream;
                await liveVideo.play();
                syncLiveOverlaySize();
                setLiveStatus('ƒêang kh·ªüi t·∫°o...', true);
                if (stopLiveBtn) {
                    stopLiveBtn.disabled = false;
                }
                liveIntervalId = setInterval(analyzeLiveFrame, LIVE_CAPTURE_INTERVAL);
                await analyzeLiveFrame();
            } catch (err) {
                console.error(err);
                liveErrorEl.textContent = err.message || 'Kh√¥ng th·ªÉ kh·ªüi t·∫°o camera.';
                setLiveStatus('Ch∆∞a k√≠ch ho·∫°t', false);
                if (startLiveBtn) {
                    startLiveBtn.disabled = false;
                }
            }
        };

        function activateSection(sectionKey) {
            if (!sectionKey) {
                return;
            }
            if (currentSection === 'camera' && sectionKey !== 'camera') {
                stopLiveCapture();
            }
            currentSection = sectionKey;
            sectionTabs.forEach(button => {
                const isActive = button.dataset.sectionTarget === sectionKey;
                button.classList.toggle('is-active', isActive);
            });
            sectionBlocks.forEach(block => {
                const isActive = block.dataset.section === sectionKey;
                block.classList.toggle('is-active', isActive);
            });
        }

        uploadArea.addEventListener('click', () => fileInput.click());
        uploadArea.addEventListener('dragover', e => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('dragover'));
        uploadArea.addEventListener('drop', e => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });
        fileInput.addEventListener('change', () => handleFiles(fileInput.files));

        sectionTabs.forEach(button => {
            button.addEventListener('click', () => activateSection(button.dataset.sectionTarget || 'image'));
        });
        
        // Threshold sliders event listeners
        const imageThreshold = document.getElementById('imageThreshold');
        const imageThresholdValue = document.getElementById('imageThresholdValue');
        const videoThreshold = document.getElementById('videoThreshold');
        const videoThresholdValue = document.getElementById('videoThresholdValue');
        const cameraThreshold = document.getElementById('cameraThreshold');
        const cameraThresholdValue = document.getElementById('cameraThresholdValue');
        const videoFrameSkip = document.getElementById('videoFrameSkip');
        const videoFrameSkipValue = document.getElementById('videoFrameSkipValue');
        
        imageThreshold.addEventListener('input', (e) => {
            imageThresholdValue.textContent = parseFloat(e.target.value).toFixed(2);
        });
        
        videoThreshold.addEventListener('input', (e) => {
            videoThresholdValue.textContent = parseFloat(e.target.value).toFixed(2);
        });
        
        cameraThreshold.addEventListener('input', (e) => {
            cameraThresholdValue.textContent = parseFloat(e.target.value).toFixed(2);
        });
        
        videoFrameSkip.addEventListener('input', (e) => {
            videoFrameSkipValue.textContent = e.target.value;
        });

        analyzeBtn.addEventListener('click', async () => {
            if (!selectedFile) return;
            setLoading(true);
            statusEl.textContent = 'ƒêang ph√¢n t√≠ch...';
            errorEl.textContent = '';

            const formData = new FormData();
            formData.append('file', selectedFile);
            formData.append('threshold', imageThreshold.value);

            try {
                const response = await fetch('/api/detect', { method: 'POST', body: formData });
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ detail: 'Kh√¥ng r√µ l·ªói' }));
                    throw new Error(errorData.detail || 'Kh√¥ng th·ªÉ ph√¢n t√≠ch ·∫£nh');
                }

                const data = await response.json();
                const summary = data.summary;

                statTotal.textContent = summary.total_faces;
                statSmile.textContent = summary.smiling_faces;

                const avgProb = summary.detections?.length
                    ? summary.detections.reduce((sum, det) => sum + det.smile_probability, 0) / summary.detections.length
                    : 0;
                statProb.textContent = summary.detections?.length ? `${(avgProb * 100).toFixed(1)}%` : '‚Äî';

                resultEl.className = '';
                resultEl.innerHTML = `
                    <p>
                        ƒê√£ ph√°t hi·ªán <strong>${summary.total_faces}</strong> khu√¥n m·∫∑t, trong ƒë√≥ c√≥
                        <strong>${summary.smiling_faces}</strong> ng∆∞·ªùi ƒëang m·ªâm c∆∞·ªùi.
                    </p>
                `;

                renderDetections(summary.detections || []);
                activateSection('image');

                if (data.annotated_image) {
                    annotatedImg.src = data.annotated_image;
                    annotatedImg.style.display = 'block';
                    annotatedPlaceholder.style.display = 'none';
                } else {
                    annotatedImg.style.display = 'none';
                    annotatedPlaceholder.style.display = 'block';
                }

                statusEl.textContent = summary.total_faces
                    ? 'Ho√†n t·∫•t! B·∫°n c√≥ th·ªÉ t·∫£i ·∫£nh kh√°c ƒë·ªÉ th·ª≠ th√™m.'
                    : 'Kh√¥ng t√¨m th·∫•y khu√¥n m·∫∑t n√†o. H√£y th·ª≠ ·∫£nh kh√°c v·ªõi g√≥c ch·ª•p r√µ h∆°n.';
            } catch (err) {
                console.error(err);
                errorEl.textContent = err.message || 'ƒê√£ x·∫£y ra l·ªói.';
                statusEl.textContent = '';
                resetResults();
            } finally {
                setLoading(false);
            }
        });

        if (videoUploadArea) {
            videoUploadArea.addEventListener('click', () => videoInput.click());
            videoUploadArea.addEventListener('dragover', e => {
                e.preventDefault();
                videoUploadArea.classList.add('dragover');
            });
            videoUploadArea.addEventListener('dragleave', () => videoUploadArea.classList.remove('dragover'));
            videoUploadArea.addEventListener('drop', e => {
                e.preventDefault();
                videoUploadArea.classList.remove('dragover');
                handleVideoFiles(e.dataTransfer.files);
            });
        }
        if (videoInput) {
            videoInput.addEventListener('change', () => handleVideoFiles(videoInput.files));
        }

        analyzeVideoBtn.addEventListener('click', async () => {
            if (!selectedVideo) return;
            activateSection('video');
            setVideoLoading(true);
            const useTracking = enableTracking.checked;
            videoStatusEl.textContent = useTracking ? 'ƒêang x·ª≠ l√Ω video v·ªõi tracking...' : 'ƒêang x·ª≠ l√Ω video...';
            videoErrorEl.textContent = '';

            const formData = new FormData();
            formData.append('file', selectedVideo);
            formData.append('threshold', videoThreshold.value);
            formData.append('frame_skip', videoFrameSkip.value);

            const apiEndpoint = useTracking ? '/api/detect-video-tracking' : '/api/detect-video';

            try {
                const response = await fetch(apiEndpoint, { method: 'POST', body: formData });
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({ detail: 'Kh√¥ng r√µ l·ªói' }));
                    throw new Error(errorData.detail || 'Kh√¥ng th·ªÉ ph√¢n t√≠ch video');
                }

                const data = await response.json();
                const summary = data.summary || {};
                renderVideoMeta(summary);

                const facesTotal = summary.faces_detected ?? 0;
                const smilesTotal = summary.smiles_detected ?? 0;
                const durationText = summary.duration_seconds ? `${summary.duration_seconds} gi√¢y` : null;
                const avgSmiles = typeof summary.avg_smiles_per_processed_frame === 'number'
                    ? summary.avg_smiles_per_processed_frame.toFixed(2)
                    : null;
                const avgFaces = typeof summary.avg_faces_per_processed_frame === 'number'
                    ? summary.avg_faces_per_processed_frame.toFixed(2)
                    : null;

                // Get unique person IDs if tracking is enabled
                const peopleIds = summary.people && summary.people.length > 0 
                    ? summary.people.map(p => p.id).sort((a, b) => a - b)
                    : [];
                const peopleIdText = peopleIds.length > 0 
                    ? `<strong style="color: #22d3ee; font-size: 1.2rem;">${peopleIds.length}</strong> <span style="color: var(--text-muted);">ng∆∞·ªùi (ID: ${peopleIds.join(', ')})</span>`
                    : `<strong style="color: #22d3ee; font-size: 1.2rem;">${facesTotal}</strong> <span style="color: var(--text-muted);">khu√¥n m·∫∑t</span>`;

                videoSummaryEl.className = '';
                let summaryHtml = `
                    <div style="padding: 1.5rem; background: linear-gradient(135deg, rgba(15, 23, 42, 0.9) 0%, rgba(30, 41, 59, 0.7) 100%); border-radius: 16px; border: 2px solid rgba(99, 102, 241, 0.3); box-shadow: 0 4px 16px rgba(0, 0, 0, 0.4);">
                        <div style="margin-bottom: 1rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(148, 163, 184, 0.2);">
                            <p style="margin: 0; font-size: 1.05rem; line-height: 1.7;">
                                <span style="color: var(--text-muted);">ƒê√£ x·ª≠ l√Ω</span> <strong style="color: #6366f1; font-size: 1.2rem;">${summary.total_frames ?? 0}</strong> <span style="color: var(--text-muted);">khung h√¨nh,</span><br>
                                <span style="color: var(--text-muted);">ph√°t hi·ªán</span> ${peopleIdText} <span style="color: var(--text-muted);">v√† ghi nh·∫≠n</span><br>
                                <strong style="color: #22c55e; font-size: 1.2rem;">${smilesTotal}</strong> <span style="color: var(--text-muted);">l·∫ßn m·ªâm c∆∞·ªùi.</span>
                            </p>
                        </div>
                `;
                if (durationText) {
                    summaryHtml += `
                        <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: rgba(99, 102, 241, 0.1); border-radius: 10px; margin-bottom: 0.75rem;">
                            <span style="font-size: 1.5rem;">‚è±Ô∏è</span>
                            <div style="flex: 1;">
                                <div style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.2rem;">Th·ªùi l∆∞·ª£ng video</div>
                                <strong style="font-size: 1.1rem; color: var(--accent);">${durationText}</strong>
                            </div>
                        </div>
                    `;
                }
                if (avgFaces) {
                    summaryHtml += `
                        <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: rgba(34, 211, 238, 0.1); border-radius: 10px; margin-bottom: 0.75rem;">
                            <span style="font-size: 1.5rem;">üë•</span>
                            <div style="flex: 1;">
                                <div style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.2rem;">Trung b√¨nh khu√¥n m·∫∑t/khung h√¨nh</div>
                                <strong style="font-size: 1.1rem; color: #22d3ee;">${avgFaces}</strong>
                            </div>
                        </div>
                    `;
                }
                if (avgSmiles) {
                    summaryHtml += `
                        <div style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; background: rgba(34, 197, 94, 0.1); border-radius: 10px;">
                            <span style="font-size: 1.5rem;">üòä</span>
                            <div style="flex: 1;">
                                <div style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 0.2rem;">Trung b√¨nh n·ª• c∆∞·ªùi/khung h√¨nh</div>
                                <strong style="font-size: 1.1rem; color: #22c55e;">${avgSmiles}</strong>
                            </div>
                        </div>
                    `;
                }
                summaryHtml += '</div>';
                videoSummaryEl.innerHTML = summaryHtml;

                // Render tracking statistics if available
                if (summary.people && summary.people.length > 0) {
                    trackingStats.hidden = false;
                    const token = data.token;
                    // Sort people by total frames (most active first)
                    const sortedPeople = [...summary.people].sort((a, b) => b.total_frames - a.total_frames);
                    peopleList.innerHTML = sortedPeople.map((person, index) => {
                        const snapshotUrl = person.snapshot ? `/api/snapshot/${token}/${person.snapshot}` : null;
                        return `
                        <div style="padding: 1.25rem; background: linear-gradient(135deg, rgba(15, 23, 42, 0.8) 0%, rgba(30, 41, 59, 0.6) 100%); border-radius: 16px; border: 2px solid ${person.is_smiling ? 'rgba(34, 211, 238, 0.3)' : 'rgba(148, 163, 184, 0.2)'}; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); transition: all 0.3s ease;">
                            <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem; gap: 1rem;">
                                <div style="display: flex; align-items: center; gap: 0.75rem; flex: 1;">
                                    <div style="background: ${person.is_smiling ? 'linear-gradient(135deg, #22d3ee, #06b6d4)' : 'rgba(148, 163, 184, 0.2)'}; width: 44px; height: 44px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.1rem; color: ${person.is_smiling ? '#0f172a' : '#94a3b8'};">
                                        ${person.id}
                                    </div>
                                    <div>
                                        <div style="font-size: 0.75rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.05em;">Ng∆∞·ªùi ${index + 1}</div>
                                        <strong style="font-size: 1.15rem; color: ${person.is_smiling ? '#22d3ee' : 'var(--text)'};">ID ${person.id}</strong>
                                    </div>
                                </div>
                                ${snapshotUrl ? `
                                    <div style="width: 80px; height: 80px; border-radius: 12px; overflow: hidden; border: 2px solid ${person.is_smiling ? 'rgba(34, 211, 238, 0.5)' : 'rgba(148, 163, 184, 0.3)'}; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);">
                                        <img src="${snapshotUrl}" alt="Snapshot ID ${person.id}" style="width: 100%; height: 100%; object-fit: cover;" />
                                    </div>
                                ` : `
                                    <span style="font-size: 3rem; filter: ${person.is_smiling ? 'drop-shadow(0 0 8px rgba(34, 211, 238, 0.6))' : 'none'};">${person.is_smiling ? 'üòä' : 'üòê'}</span>
                                `}
                            </div>
                            
                            <!-- Progress bar for smile ratio -->
                            <div style="margin-bottom: 1rem;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                                    <span style="font-size: 0.85rem; color: var(--text-muted); font-weight: 500;">T·ªâ l·ªá c∆∞·ªùi</span>
                                    <strong style="font-size: 1.1rem; color: ${person.is_smiling ? '#22d3ee' : 'inherit'};">${(person.smile_ratio * 100).toFixed(1)}%</strong>
                                </div>
                                <div style="width: 100%; height: 8px; background: rgba(148, 163, 184, 0.15); border-radius: 999px; overflow: hidden;">
                                    <div style="width: ${(person.smile_ratio * 100).toFixed(1)}%; height: 100%; background: ${person.is_smiling ? 'linear-gradient(90deg, #22d3ee, #06b6d4)' : 'rgba(148, 163, 184, 0.4)'}; transition: width 0.5s ease; box-shadow: ${person.is_smiling ? '0 0 8px rgba(34, 211, 238, 0.5)' : 'none'};"></div>
                                </div>
                            </div>

                            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 1rem; font-size: 0.9rem;">
                                <div style="background: rgba(15, 23, 42, 0.5); padding: 0.75rem; border-radius: 10px; border: 1px solid rgba(148, 163, 184, 0.1);">
                                    <div style="color: var(--text-muted); font-size: 0.75rem; margin-bottom: 0.25rem; display: flex; align-items: center; gap: 0.3rem;">
                                        <span>‚è±Ô∏è</span> Th·ªùi l∆∞·ª£ng
                                    </div>
                                    <strong style="font-size: 1.1rem; color: var(--accent);">${person.duration}s</strong>
                                </div>
                                <div style="background: rgba(15, 23, 42, 0.5); padding: 0.75rem; border-radius: 10px; border: 1px solid rgba(148, 163, 184, 0.1);">
                                    <div style="color: var(--text-muted); font-size: 0.75rem; margin-bottom: 0.25rem; display: flex; align-items: center; gap: 0.3rem;">
                                        <span>üìä</span> T·ªïng frames
                                    </div>
                                    <strong style="font-size: 1.1rem;">${person.total_frames}</strong>
                                </div>
                                <div style="background: rgba(15, 23, 42, 0.5); padding: 0.75rem; border-radius: 10px; border: 1px solid ${person.is_smiling ? 'rgba(34, 211, 238, 0.2)' : 'rgba(148, 163, 184, 0.1)'};">
                                    <div style="color: var(--text-muted); font-size: 0.75rem; margin-bottom: 0.25rem; display: flex; align-items: center; gap: 0.3rem;">
                                        <span>üòä</span> Frames c∆∞·ªùi
                                    </div>
                                    <strong style="font-size: 1.1rem; color: ${person.is_smiling ? '#22d3ee' : 'inherit'};">${person.smile_frames}</strong>
                                </div>
                                <div style="background: rgba(15, 23, 42, 0.5); padding: 0.75rem; border-radius: 10px; border: 1px solid ${person.is_smiling ? 'rgba(34, 211, 238, 0.2)' : 'rgba(148, 163, 184, 0.1)'};">
                                    <div style="color: var(--text-muted); font-size: 0.75rem; margin-bottom: 0.25rem; display: flex; align-items: center; gap: 0.3rem;">
                                        <span>‚è∞</span> T/gian c∆∞·ªùi
                                    </div>
                                    <strong style="font-size: 1.1rem; color: ${person.is_smiling ? '#22d3ee' : 'inherit'};">${person.smile_duration}s</strong>
                                </div>
                            </div>
                        </div>
                    `}).join('');
                } else {
                    trackingStats.hidden = true;
                }

                if (data.download_url) {
                    const videoResp = await fetch(data.download_url);
                    if (!videoResp.ok) {
                        throw new Error('Kh√¥ng th·ªÉ t·∫£i video k·∫øt qu·∫£');
                    }
                    const blob = await videoResp.blob();
                    if (resultVideoUrl) {
                        URL.revokeObjectURL(resultVideoUrl);
                    }
                    resultVideoUrl = URL.createObjectURL(blob);
                    videoResult.src = resultVideoUrl;
                    videoResult.style.display = 'block';
                    videoResultPlaceholder.style.display = 'none';
                    videoResult.load();
                    
                    // Add download button after video
                    const existingBtn = document.getElementById('downloadVideoBtn');
                    if (existingBtn) existingBtn.remove();
                    
                    const downloadBtn = document.createElement('a');
                    downloadBtn.id = 'downloadVideoBtn';
                    downloadBtn.href = resultVideoUrl;
                    downloadBtn.download = `smile_detection_${Date.now()}.mp4`;
                    downloadBtn.style.cssText = 'display: inline-block; margin-top: 1rem; padding: 0.9rem 1.8rem; background: linear-gradient(135deg, #22d3ee, #06b6d4); color: #0f172a; font-weight: 600; border-radius: 12px; text-decoration: none; box-shadow: 0 4px 12px rgba(34, 211, 238, 0.4); transition: all 0.3s ease; cursor: pointer;';
                    downloadBtn.innerHTML = '‚¨áÔ∏è T·∫£i video xu·ªëng';
                    downloadBtn.onmouseover = () => {
                        downloadBtn.style.transform = 'translateY(-2px)';
                        downloadBtn.style.boxShadow = '0 6px 16px rgba(34, 211, 238, 0.5)';
                    };
                    downloadBtn.onmouseout = () => {
                        downloadBtn.style.transform = 'translateY(0)';
                        downloadBtn.style.boxShadow = '0 4px 12px rgba(34, 211, 238, 0.4)';
                    };
                    videoResult.parentElement.appendChild(downloadBtn);
                } else {
                    videoResult.style.display = 'none';
                    videoResultPlaceholder.style.display = 'block';
                }

                videoStatusEl.textContent = 'Ho√†n t·∫•t! Video ƒë√£ ƒë∆∞·ª£c ch√∫ th√≠ch.';
            } catch (err) {
                console.error(err);
                videoErrorEl.textContent = err.message || 'ƒê√£ x·∫£y ra l·ªói khi x·ª≠ l√Ω video.';
                videoStatusEl.textContent = '';
                resetVideoResults();
            } finally {
                setVideoLoading(false);
            }
        });

        if (startLiveBtn && stopLiveBtn) {
            startLiveBtn.addEventListener('click', startLiveCapture);
            stopLiveBtn.addEventListener('click', stopLiveCapture);
        }
        if (liveVideo) {
            liveVideo.addEventListener('loadedmetadata', syncLiveOverlaySize);
            liveVideo.addEventListener('resize', syncLiveOverlaySize);
            liveVideo.addEventListener('playing', syncLiveOverlaySize);
        }
        window.addEventListener('beforeunload', stopLiveCapture);

        // Kh·ªüi t·∫°o trang ·ªü tr·∫°ng th√°i s·∫°ch
        resetResults();
        resetVideoResults();
        resetLiveStats();
        activateSection('image');
    </script>
</body>
</html>
